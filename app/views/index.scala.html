@(accumulatedResults: java.util.Map[String, scala.Tuple2[java.util.List[models.Article], java.lang.Double]], emoticon: String)

@main("NotiLytics") {

<style>
    :root{
      --primary:#2563eb;--happy:#10b981;--sad:#ef4444;--neutral:#6b7280;
      --bg:#f9fafb;--card:#ffffff;--radius:.75rem;--shadow:0 4px 12px rgba(0,0,0,.08)
    }
    body{background:var(--bg);font-family:system-ui,Arial,sans-serif;margin:0;color:#1f2937}
    .nl-wrap{max-width:900px;margin:2rem auto;padding:0 1rem}
    .nl-header{text-align:center;margin-bottom:2rem}
    .nl-header h1{font-size:2rem;margin:.25rem 0}
    .nl-header p{color:#6b7280}

    /* search bar */
    .nl-search{display:flex;gap:.5rem;margin-bottom:1.5rem}
    .nl-search input{flex:1;padding:.75rem 1rem;font-size:1rem;border:2px solid #e5e7eb;border-radius:var(--radius);transition:border .2s}
    .nl-search input:focus{outline:none;border-color:var(--primary)}
    .nl-search button{padding:.75rem 1.5rem;font-size:1rem;background:var(--primary);color:#fff;border:none;border-radius:var(--radius);cursor:pointer;transition:background .2s}
    .nl-search button:hover{background:#1e40af}

    /* sentiment banner */
    .nl-sent{display:flex;align-items:center;gap:.5rem;margin-bottom:1.5rem;font-size:1.25rem}
    .nl-sent .emo{font-size:2rem}
    .nl-sent.happy .emo{color:var(--happy)}
    .nl-sent.sad .emo{color:var(--sad)}
    .nl-sent.neutral .emo{color:var(--neutral)}

    /* articles */
    .nl-grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}
    .nl-card{background:var(--card);border:1px solid #e5e7eb;border-radius:var(--radius);padding:1.25rem;transition:box-shadow .2s}
    .nl-card:hover{box-shadow:var(--shadow)}
    .nl-card a.title{font-weight:600;color:#111827;text-decoration:none;font-size:1.05rem;display:block;margin-bottom:.5rem}
    .nl-card a.title:hover{text-decoration:underline}
    .nl-card .meta{font-size:.85rem;color:#6b7280;margin-bottom:.25rem}
    .nl-card .readability{font-size:.85rem;font-weight:600;color:var(--happy)}

    .keyword-title{margin-top:2rem;margin-bottom:0.5rem;font-size:1.2rem;font-weight:600;color:#111827}
</style>

<div class="nl-wrap">
    <header class="nl-header">
        <h1>NotiLytics</h1>
        <p>Real-time news search with sentiment & readability analytics</p>
    </header>

    <form class="nl-search" action="/search" method="get">
        <input type="text" name="query" placeholder="Search keyword …" value="" required />
        <button type="submit">Search</button>
    </form>

    <a href="/sources">
        <button style="padding:.75rem 1.5rem;background:#2563eb;color:#fff;border:none;border-radius:.75rem;cursor:pointer">
            View News Sources
        </button>
    </a>

    @defining(
    emoticon match {
    case ":-)" => "happy"
    case ":-(" => "sad"
    case _     => "neutral"
    }
    ) { sentimentClass =>
    <div class="nl-sent @sentimentClass">
        <span>Search terms: <b>@accumulatedResults.keySet.mkString(", ")</b></span>
        <span class="emo">@emoticon</span>
    </div>
    }

    @for((keyword, data) <- scala.jdk.CollectionConverters.MapHasAsScala(accumulatedResults).asScala.toSeq.reverse) {
    @defining(data._1) { articles =>
    @defining(data._2) { avgReadability =>
    <div class="keyword-title">
        Keyword: @keyword (Avg. Readability: @("%.2f".format(avgReadability)))
        &nbsp; | &nbsp;
        <a href="/wordstats/@keyword"
            target="_blank"
            style="font-size:0.95rem;color:#2563eb;text-decoration:none;">
            View Word Stats
        </a>
    </div>
    <div class="nl-grid">
        @for(a <- articles.asScala) {
        <article class="nl-card">
            <a class="title" href="@a.getUrl()" target="_blank" rel="noopener">@a.getTitle()</a>
            <div class="meta">
                Source: <a href="@a.getSourceUrl()" target="_blank">@a.getSourceName()</a>
                · @a.getPublishedAt()
            </div>
            <div class="meta">@a.getDescription()</div>
            <div class="readability">Readability: @a.getReadabilityScore()</div>
        </article>
        }
    </div>
    }
    }
    }

    @if(accumulatedResults.isEmpty) {
    <p style="text-align:center;margin-top:2rem;color:#6b7280">
        No articles yet. Try searching a keyword.
    </p>
    }
</div>

}
